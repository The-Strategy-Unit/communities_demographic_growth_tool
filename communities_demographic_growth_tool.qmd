---
title: |
  Community Services: Projected Demographic Growth
subtitle: Projected care contacts to 2041, based on the 2022-23 CSDS dataset
author:
  name: Fran Barton
  email: francis.barton1@nhs.net
date: today
lang: en-GB
theme: materia
embed-resources: true
fig-dpi: 144
fig-height: 10
fig-width: 16.18
fig-responsive: true
out-width: 92%
execute:
  warning: false
  echo: false
---


```{r setup}

library(dplyr)
library(ggplot2)
library(StrategyUnitTheme)

icb_contacts_fy_projected <- readr::read_rds("contacts_fy_projected_icb.rds")
consistent_providers <- readr::read_csv("consistent_providers_2022_23.csv")

```


```{r data-summary-functions}



summarise_total_contacts_by_year <- function(x) {
  x |>
    purrr::map(\(x) {
      x |>
        dplyr::summarise(
          dplyr::across("projected_contacts", sum),
          .by = "fin_year"
        )
    })
}


add_age_groups <- function(.data) {
  .data |>
    dplyr::mutate(age_group_cat = dplyr::case_when(
      age_int == 0L ~ "0",
      age_int %in% seq(1L, 4L) ~ "1-4",
      age_int %in% seq(5L, 9L) ~ "5-9",
      age_int %in% seq(10L, 15L) ~ "10-15",
      age_int %in% seq(16L, 17L) ~ "16-17",
      age_int %in% seq(18L, 34L) ~ "18-34",
      age_int %in% seq(35L, 49L) ~ "35-49",
      age_int %in% seq(50L, 64L) ~ "50-64",
      age_int %in% seq(65L, 74L) ~ "65-74",
      .default = "85+"
    ))
}

# Purely invented new groupings - they might be useful for some charts?
add_broad_age_groups <- function(.data) {
  .data |>
    dplyr::mutate(broad_age_cat = dplyr::case_when(
      age_int %in% seq(0L, 15L) ~ "0-15",
      age_int %in% seq(16L, 49L) ~ "16-49",
      age_int %in% seq(50L, 74L) ~ "50-74",
      .default = "75+"
    ))
}




```


## National contacts projection by financial year


TODO filter only to consistent submitters and attended appointments.

Consistent submitters: submitted CSDS data each month in 2022-23.
2023-24 data includes mandatory attendance data - all submitters in theory
  should now be consistent!
But for first run (Mar 2025), we will stick to 2022-23 data specifically.


```{r chart1}
#| eval: false


contacts_fy_projected_national |>
  ggplot2::ggplot(aes(fin_year, total_contacts_by_year)) +
  ggplot2::geom_line()



```
